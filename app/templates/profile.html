{% extends "base.html" %}

{% block content %}
<div class="main-container">
    <div class="container">
        <h2>Your Profile</h2>
        <p>Update your profile.</p>
    </div>
</div>
<div class="content-container">
    <form method="POST" action="" class="profile-form" enctype="multipart/form-data">
        {{ form.hidden_tag() }}
        <!-- Flash messages block -->
        {% with messages = get_flashed_messages() %}
        {% if messages %}
        <div class="flash-messages">
            {% for message in messages %}
                <div class="alert alert-danger"><span style="color: red;">{{ message }}</span></div>
            {% endfor %}
        </div>
        {% endif %}
        {% endwith %}

        <!-- Display existing profile pictures in a carousel -->
        {% if current_user.profile_picture %}
        <div id="carouselProfilePictures" class="carousel slide" data-ride="carousel">
            <div class="carousel-inner">
                {% for picture in current_user.profile_picture %}
                <div class="carousel-item {% if loop.first %}active{% endif %}">
                    <img src="{{ url_for('static', filename='profile_uploads/' ~ picture) }}" alt="Profile Picture" class="d-block w-100">
                    <button type="submit" name="delete_picture" value="{{ picture }}" class="btn btn-danger">Delete</button>
                </div>
                {% endfor %}
            </div>
            <a class="carousel-control-prev" href="#carouselProfilePictures" role="button" data-slide="prev">
                <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                <span class="sr-only">Previous</span>
            </a>
            <a class="carousel-control-next" href="#carouselProfilePictures" role="button" data-slide="next">
                <span class="carousel-control-next-icon" aria-hidden="true"></span>
                <span class="sr-only">Next</span>
            </a>
        </div>
        {% endif %}

        <!-- Profile form fields -->
        {% for field in form if field.name != 'submit' and field.type != 'CSRFTokenField' %}
            {% if field.name == 'politics' %}
                <div class="form-group">
                {{ form.politics.label(class_='form-label') }}
                <small class="form-text text-muted">What politics do you align with?</small>
                <div class="checkbox-columns">
                    {% for subfield in form.politics %}
                        <div class="checkbox-column">
                            {{ subfield }} {{ subfield.label }}
                        </div>
                    {% endfor %}
                </div>
                </div>
            {% elif field.name == 'handling_money' %}
                <div class="form-group">
                {{ form.handling_money.label(class_='form-label') }}
                <small class="form-text text-muted">How do you handle money?</small>
                <div class="checkbox-columns">
                    {% for subfield in form.handling_money %}
                        <div class="checkbox-column">
                            {{ subfield }} {{ subfield.label }}
                        </div>
                    {% endfor %}
                </div>
                </div>
            {% elif field.name == 'religion' %}
                <div class="form-group">
                {{ form.religion.label(class_='form-label') }}
                <small class="form-text text-muted">Are you religious/What do you align with?</small>
                    {{ field(class_='form-control') }}
                </div>
            {% elif field.name == 'profile_picture' %}
                <div class="form-group">
                    {{ form.profile_picture.label(class_='form-label') }}
                    <small class="form-text text-muted">Upload up to 8 profile pictures (Max 8 MB each).</small>
                    {{ field(class_='form-control', multiple=True) }}
                </div>
            {% else %}
                <div class="form-group">
                    {{ field.label(class_='form-label') }}
                    {% if field.name == 'bio' %}
                    <small class="form-text text-muted">Create a bio that lets others know what you're all about if they match with you (5000 Chars Max).</small>
                    {{ field(class_='form-label', id='editor') }}
                    {% else %}
                    {{ field(class_='form-control') }}
                    {% endif %}
                </div>
            {% endif %}
        {% endfor %}

        <div class="form-group">
            {{ form.submit(class_="btn") }}
        </div>
        <script>
            document.addEventListener("DOMContentLoaded", function() {
                const profilePictureInput = document.querySelector('input[name="profile_picture"]');
                const previewContainer = document.createElement('div');
                profilePictureInput.parentElement.appendChild(previewContainer);
            
                profilePictureInput.addEventListener('change', function() {
                    previewContainer.innerHTML = ''; // Clear previous previews
                    const files = profilePictureInput.files;
            
                    for (let i = 0; i < files.length; i++) {
                        const file = files[i];
                        const reader = new FileReader();
            
                        reader.onload = function(e) {
                            const img = document.createElement('img');
                            img.src = e.target.result;
                            img.style.width = '100px'; // Adjust as needed
                            img.style.margin = '5px';
                            previewContainer.appendChild(img);
                        }
            
                        reader.readAsDataURL(file);
                    }
                });
            });
        </script>
            
    </form>
</div>

{% endblock %}
